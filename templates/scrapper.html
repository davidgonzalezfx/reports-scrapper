<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Available Reports</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						primary: {
							50: '#f0f9ff',
							100: '#e0f2fe',
							200: '#bae6fd',
							300: '#7dd3fc',
							400: '#38bdf8',
							500: '#0ea5e9',
							600: '#0284c7',
							700: '#0369a1',
							800: '#075985',
							900: '#0c4a6e',
						}
					}
				}
			}
		}
	</script>
	<style>
		/* Enhanced animations and interactions */
		@keyframes slideInUp {
			from {
				opacity: 0;
				transform: translateY(20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}

		@keyframes pulse {

			0%,
			100% {
				opacity: 1;
			}

			50% {
				opacity: 0.5;
			}
		}

		.animate-slide-up {
			animation: slideInUp 0.5s ease-out;
		}

		.animate-fade-in {
			animation: fadeIn 0.3s ease-out;
		}

		/* Custom scrollbar */
		::-webkit-scrollbar {
			width: 8px;
		}

		::-webkit-scrollbar-track {
			background: #f1f5f9;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb {
			background: #cbd5e1;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #94a3b8;
		}

		/* Enhanced button effects */
		.btn-hover-lift:hover {
			transform: translateY(-2px);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
		}

		/* File upload drag and drop enhancement */
		.file-drop-zone {
			transition: all 0.3s ease;
		}

		.file-drop-zone.dragover {
			border-color: #3b82f6 !important;
			background-color: #eff6ff !important;
			transform: scale(1.02);
		}

		/* Loading state improvements */
		.loading-overlay {
			background: rgba(255, 255, 255, 0.9);
			backdrop-filter: blur(4px);
		}

		/* Gradient text effect */
		.gradient-text {
			background: linear-gradient(135deg, #667eea 0%, #8c9ed7 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		/* Status indicators */
		.status-indicator {
			position: relative;
			overflow: hidden;
		}

		.status-indicator::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
			transition: left 0.5s;
		}

		.status-indicator:hover::before {
			left: 100%;
		}

		/* Legacy styles */
		.file-item:hover .file-actions {
			opacity: 1;
		}

		.spinner {
			display: none;
		}

		.spinner.show {
			display: inline-block;
		}
	</style>
</head>

<body class="bg-gray-50 min-h-screen">
	<div class="max-w-6xl mx-auto px-4 py-8">
		<!-- Header -->
		<div class="mb-12 text-center">
			<div class="inline-flex items-center gap-3 mb-4">
				<div
					class="w-16 h-16 bg-gradient-to-r from-blue-600 via-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center shadow-xl">
					<i class="fas fa-spider text-white text-2xl"></i>
				</div>
				<div class="text-left">
					<h1 class="text-4xl font-bold gradient-text">Reports Scraper</h1>
					<p class="text-lg text-gray-600">Professional Data Collection Dashboard</p>
				</div>
			</div>
		</div>

		<!-- Authentication Section (with User Management) -->
		<div class="bg-white rounded-lg shadow-lg p-6 mb-6 border border-gray-100 animate-slide-up">
			<h2 class="text-xl font-semibold text-gray-800 mb-6">
				<i class="fas fa-users mr-2 text-primary-600"></i>Authentication Management
			</h2>

			<!-- File Upload Section -->
			<div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border border-blue-100">
				<div class="flex items-start gap-4 mb-4">
					<div class="flex-shrink-0">
						<div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
							<i class="fas fa-cloud-upload-alt text-white text-lg"></i>
						</div>
					</div>
					<div class="flex-1">
						<h3 class="text-lg font-semibold text-gray-900 mb-2">Quick Import Users</h3>
						<p class="text-sm text-gray-600 mb-4">
							Upload a JSON file to instantly replace your current user configuration.
							Perfect for switching between different environments or teams.
						</p>
					</div>
				</div>

				<form id="upload-form" enctype="multipart/form-data">
					<div class="space-y-4">
						<!-- File Input with Custom Styling -->
						<div class="relative">
							<input type="file" id="users-file" name="users_file" accept=".json" class="hidden"
								onchange="updateFileName(this)">
							<label for="users-file"
								class="group relative block w-full p-4 border-2 border-dashed border-blue-300 rounded-lg bg-white hover:bg-blue-50 hover:border-blue-400 transition-all duration-200 cursor-pointer">
								<div class="flex items-center justify-center gap-3 text-center">
									<div class="flex-shrink-0">
										<i class="fas fa-file-upload text-blue-500 text-xl group-hover:text-blue-600"></i>
									</div>
									<div>
										<p class="text-sm font-medium text-gray-700 group-hover:text-gray-900">
											<span id="file-label">Choose JSON file or drag and drop</span>
										</p>
										<p class="text-xs text-gray-500 mt-1">
											Only .json files are accepted
										</p>
									</div>
								</div>
							</label>
						</div>

						<!-- Upload Button -->
						<div class="flex justify-end">
							<button type="submit" id="upload-btn"
								class="group relative inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg shadow-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
								<i class="fas fa-cloud-upload-alt text-lg"></i>
								<span>Import Configuration</span>
								<div
									class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200">
								</div>
							</button>
						</div>

						<!-- Status Message -->
						<div id="upload-message" class="hidden p-3 rounded-lg text-sm font-medium"></div>
					</div>
				</form>
			</div>

			<!-- Manual User Management -->
			<div class="border-t border-gray-200 pt-6">
				<h3 class="text-lg font-medium text-gray-800 mb-4">
					<i class="fas fa-edit mr-2 text-gray-600"></i>Manual User Management
				</h3>

				<form id="users-form">
					<div class="space-y-4" id="users-container">
						{% for user in users %}
						<div
							class="group bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 user-row">
							<div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
								<div class="space-y-2">
									<label class="block text-xs font-semibold text-gray-700 uppercase tracking-wider">
										<i class="fas fa-user mr-1"></i>Username
									</label>
									<input type="text" name="username" value="{{ user.username }}"
										class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 focus:bg-white transition-all duration-200"
										placeholder="Enter email or username">
								</div>
								<div class="space-y-2">
									<label class="block text-xs font-semibold text-gray-700 uppercase tracking-wider">
										<i class="fas fa-lock mr-1"></i>Password
									</label>
									<input type="password" name="password" value="{{ user.password }}"
										class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 focus:bg-white transition-all duration-200"
										placeholder="Enter password">
								</div>
								<div class="flex justify-center md:justify-end">
									<button type="button"
										class="group/remove relative inline-flex items-center gap-2 px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow-md hover:from-red-600 hover:to-indigo-600 focus:outline-none focus:ring-4 focus:ring-red-300 transform transition-all duration-200 remove-user">
										<i class="fas fa-trash-alt"></i>
										<span class="text-sm">Remove</span>
										<div
											class="absolute inset-0 bg-white opacity-0 group-hover/remove:opacity-20 rounded-lg transition-opacity duration-200">
										</div>
									</button>
								</div>
							</div>
						</div>
						{% endfor %}
					</div>

					<!-- Empty State -->
					<div id="empty-users" class="{% if users %}hidden{% endif %} text-center py-8">
						<div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
							<i class="fas fa-user-plus text-blue-600 text-xl"></i>
						</div>
						<h3 class="text-lg font-semibold text-gray-900 mb-2">No Users Yet</h3>
						<p class="text-gray-600 mb-4">Add your first user account to get started with scraping</p>
						<button type="button" id="add-first-user"
							class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg shadow-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200">
							<i class="fas fa-plus"></i>
							<span>Add First User</span>
						</button>
					</div>

					<!-- Action Buttons -->
					<div class="flex justify-between items-center pt-6">
						<button type="button" id="add-user"
							class="group relative inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-medium rounded-lg shadow-md hover:from-gray-700 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all duration-200">
							<i class="fas fa-user-plus"></i>
							<span>Add Another User</span>
							<div
								class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200">
							</div>
						</button>

						<button type="submit"
							class="group relative inline-flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg shadow-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200">
							<i class="fas fa-save"></i>
							<span>Save All Users</span>
							<div
								class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200">
							</div>
						</button>
					</div>
				</form>


			</div>
		</div>

		<!-- Filter and Configuration Form -->
		<div class="bg-white rounded-lg shadow-lg p-6 mb-6 border border-gray-100 animate-slide-up">
			<div class="flex items-center gap-3 mb-6">
				<div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
					<i class="fas fa-sliders-h text-white text-lg"></i>
				</div>
				<div>
					<h2 class="text-xl font-semibold text-gray-900">Filter & Configuration</h2>
					<p class="text-sm text-gray-600">Customize your scraping preferences</p>
				</div>
			</div>

			<form id="filter-form" method="post" action="/set-filter">
				<!-- Main Configuration Grid -->
				<div class="bg-blue-50 rounded-xl p-6 mb-6 border border-blue-100">
					<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
						<!-- Date Filter Section -->
						<div class="space-y-3">
							<div class="flex items-center gap-2 mb-3">
								<div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
									<i class="fas fa-calendar-alt text-white text-sm"></i>
								</div>
								<label for="date_filter" class="text-sm font-semibold text-gray-900">
									Date Range Filter
								</label>
							</div>
							<select id="date_filter" name="date_filter"
								class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md">
								{% for option in date_filters %}
								<option value="{{ option }}" {% if option==selected_date_filter %}selected{% endif %}>{{
									option }}</option>
								{% endfor %}
							</select>
							<p class="text-xs text-gray-600">Choose the time period for data collection</p>
						</div>

						<!-- Products Filter Section -->
						<div class="space-y-3">
							<div class="flex items-center gap-2 mb-3">
								<div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
									<i class="fas fa-cube text-white text-sm"></i>
								</div>
								<label for="products_filter" class="text-sm font-semibold text-gray-900">
									Products Filter
								</label>
							</div>
							<select id="products_filter" name="products_filter"
								class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md">
								{% for option in products_filters %}
								<option value="{{ option }}" {% if option==selected_products_filter %}selected{% endif %}>{{
									option }}</option>
								{% endfor %}
							</select>
							<p class="text-xs text-gray-600">Choose the product for data collection</p>
							<div id="products-filter-warning" class="hidden p-3 bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-300 rounded-lg text-xs text-yellow-800">
								<div class="flex items-start gap-2">
									<i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5"></i>
									<div>
										<p class="font-medium">Product Availability Notice</p>
										<p class="mt-1">Not all users have access to all products. If this product is unavailable during scraping, you'll see a notification after the process completes.</p>
									</div>
								</div>
							</div>
						</div>

						<!-- Quick Selection Section -->
						<div class="space-y-3">
							<div class="flex items-center gap-2 mb-3">
								<div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
									<i class="fas fa-magic text-white text-sm"></i>
								</div>
								<label class="text-sm font-semibold text-gray-900">
									Quick Actions
								</label>
							</div>
							<div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
								<label
									class="group flex items-center gap-3 cursor-pointer hover:bg-gray-50 rounded-lg p-2 transition-colors">
									<div class="relative">
										<input type="checkbox" id="select-all" class="sr-only" onchange="toggleAll(this.checked)">
										<div
											class="w-5 h-5 border-2 border-gray-300 rounded group-hover:border-blue-500 transition-colors flex items-center justify-center bg-white">
											<i class="fas fa-check text-white text-xs opacity-0" id="select-all-icon"></i>
										</div>
									</div>
									<span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">Select
										All Report Types</span>
								</label>
							</div>
							<p class="text-xs text-gray-600">Toggle all report types at once</p>
						</div>

						<!-- Institution Name Section -->
						<div class="space-y-3">
							<div class="flex items-center gap-2 mb-3">
								<div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
									<i class="fas fa-school text-white text-sm"></i>
								</div>
								<label for="institution_name" class="text-sm font-semibold text-gray-900">
									Institution Name
								</label>
							</div>
							<input type="text" id="institution_name" name="institution_name"
								value="{{ selected_institution_name }}"
								class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md"
								placeholder="Enter institution name">
							<p class="text-xs text-gray-600">Name of the educational institution for reports</p>
						</div>
					</div>
				</div>

				<!-- Tabs Selection -->
				<div class="mb-6">
					<div class="flex items-center gap-2 mb-4">
						<div
							class="w-8 h-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
							<i class="fas fa-th-large text-white text-sm"></i>
						</div>
						<h3 class="text-lg font-semibold text-gray-900">Report Types</h3>
					</div>
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3">
						{% for tab in tabs %}
						<div class="group">
							<label
								class="relative block p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-300 hover:shadow-md transition-all duration-200 tab-card">
								<input type="checkbox" id="tab-{{ loop.index }}" name="tabs" value="{{ tab.name }}"
									class="sr-only tab-checkbox" {% if selected_tabs.get(tab.name, tab.default) %}checked{% endif %}>
								<div class="flex flex-col items-center text-center space-y-2">
									<div
										class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-blue-100 transition-colors">
										<i class="fas fa-chart-bar text-gray-600 group-hover:text-blue-600 transition-colors"></i>
									</div>
									<span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">{{
										tab.name }}</span>
									<div
										class="absolute top-2 right-2 w-5 h-5 border-2 border-gray-300 rounded bg-white tab-checkbox-visual flex items-center justify-center">
										<i class="fas fa-check text-white text-xs opacity-0 tab-check-icon"></i>
									</div>
								</div>
							</label>
						</div>
						{% endfor %}
					</div>
				</div>

				<!-- Action Buttons -->
				<div class="flex justify-between items-center pt-6 border-t border-gray-200">
					<div class="text-sm text-gray-600">
						<i class="fas fa-info-circle mr-1"></i>
						Changes will be applied to your next scraping session
					</div>
					<button type="submit"
						class="group relative inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200">
						<i class="fas fa-save text-lg"></i>
						<span>Save Configuration</span>
						<div
							class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200">
						</div>
					</button>
				</div>
			</form>
		</div>

		<!-- Scraper Controls -->
		<div class="bg-white rounded-lg shadow-lg p-6 mb-6 border border-gray-100 animate-slide-up">
			<div class="flex items-center gap-3 mb-6">
				<div
					class="w-10 h-10 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg flex items-center justify-center">
					<i class="fas fa-robot text-white text-lg"></i>
				</div>
				<div>
					<h2 class="text-xl font-semibold text-gray-900">Scraper Controls</h2>
					<p class="text-sm text-gray-600">Execute data collection with your configured settings</p>
				</div>
			</div>

			<div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
				<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
					<!-- Status Information -->
					<div class="lg:col-span-2 space-y-4">
						<div class="flex items-start gap-4">
							<div class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
								<i class="fas fa-info-circle text-white text-sm"></i>
							</div>
							<div>
								<h3 class="text-sm font-semibold text-gray-900 mb-2">Ready to Scrape</h3>
								<div class="space-y-1 text-xs text-gray-600">
									<div class="flex items-center gap-2">
										<i class="fas fa-users w-3"></i>
										<span id="user-count">{{ users|length }} user(s) configured</span>
									</div>
									<div class="flex items-center gap-2">
										<i class="fas fa-calendar w-3"></i>
										<span>Date filter: {{ selected_date_filter }}</span>
									</div>
									<div class="flex items-center gap-2">
										<i class="fas fa-cube w-3"></i>
										<span>Products filter: {{ selected_products_filter }}</span>
									</div>
									<div class="flex items-center gap-2">
										<i class="fas fa-th-large w-3"></i>
										<span id="tab-count">{{ selected_tabs.values()|select|list|length }} report
											type(s) selected</span>
									</div>
								</div>
							</div>
						</div>

						<div class="bg-white rounded-lg p-3 border border-green-200">
							<div class="flex items-center gap-2 text-xs text-green-700">
								<i class="fas fa-shield-alt"></i>
								<span>Scraper will run with current configuration</span>
							</div>
						</div>
					</div>

					<!-- Action Button -->
					<div class="flex justify-center lg:justify-end">
						<form id="scrape-form" action="/scrape" method="post" class="w-full max-w-xs">
							<button id="scrape-btn" type="submit"
								class="group relative w-full inline-flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold rounded-xl shadow-xl hover:from-green-700 hover:to-emerald-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">

								<div class="scrap-text-elements flex items-center gap-3">
									<div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
										<i class="fas fa-play text-sm"></i>
									</div>
									<div class="text-left">
										<div class="text-sm font-bold">Start Scraping</div>
										<div class="text-xs opacity-90">Execute now</div>
									</div>
								</div>

								<div class="spinner hidden" id="spinner">
									<div class="flex items-center gap-3">
										<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent">
										</div>
										<div class="text-left">
											<div class="text-sm font-bold">Processing...</div>
											<div class="text-xs opacity-90">Please wait</div>
										</div>
									</div>
								</div>

								<div
									class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-xl transition-opacity duration-200">
								</div>
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Scraper Status Notifications -->
		<div id="scraper-notifications" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6 border border-gray-100 animate-slide-up">
			<div class="flex items-center justify-between mb-4">
				<div class="flex items-center gap-3">
					<div class="w-10 h-10 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg flex items-center justify-center">
						<i class="fas fa-exclamation-triangle text-white text-lg"></i>
					</div>
					<div>
						<h2 class="text-xl font-semibold text-gray-900">Scraper Notifications</h2>
						<p class="text-sm text-gray-600">Important updates about your scraping session</p>
					</div>
				</div>
				<button id="clear-notifications-btn" onclick="clearAllNotifications()" 
					class="group relative inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-medium rounded-lg shadow-md hover:from-gray-700 hover:to-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all duration-200">
					<i class="fas fa-times-circle"></i>
					<span>Clear All</span>
				</button>
			</div>
			
			<div id="notifications-content" class="space-y-3">
				<!-- Notifications will be populated here -->
			</div>
		</div>

		<!-- Results Section -->
		<div class="bg-white rounded-lg shadow-lg p-6 border border-gray-100 animate-slide-up">
			<div class="flex items-center justify-between mb-6">
				<div class="flex items-center gap-3">
					<div
						class="w-10 h-10 bg-gradient-to-r from-orange-600 to-red-600 rounded-lg flex items-center justify-center">
						<i class="fas fa-download text-white text-lg"></i>
					</div>
					<div>
						<h2 class="text-xl font-semibold text-gray-900">Downloaded Reports</h2>
						<p class="text-sm text-gray-600">Manage and download your collected data</p>
					</div>
				</div>

				<div class="flex items-center gap-4">
					<div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg px-3 py-2 border border-orange-200">
						<div class="flex items-center gap-2 text-sm">
							<div class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></div>
							<span class="text-orange-700 font-medium">{{ files|length }} files ready</span>
						</div>
					</div>

					{% if files|length > 0 %}
					<a href="/report"
						class="group relative inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg shadow-md hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all duration-200">
						<i class="fas fa-chart-line"></i>
						<span>View Report</span>
						<div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200"></div>
					</a>
					{% endif %}
				</div>
			</div>

			{% if combined_report %}
			<!-- Combined Report Highlight -->
			<div class="mb-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200">
				<div class="flex items-start gap-4">
					<div class="w-12 h-12 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
						<i class="fas fa-layer-group text-white text-xl"></i>
					</div>
					<div class="flex-1">
						<h3 class="text-lg font-bold text-gray-900 mb-2">Combined All Reports Available</h3>
						<p class="text-sm text-gray-600 mb-3">
							All reports have been automatically combined into a single multi-sheet Excel file.
							Each sheet contains data for one report type (Student Usage, Skill, Assignment, Assessment, Level Up Progress).
						</p>
						<div class="flex items-center gap-6 text-sm text-gray-500">
							<span class="flex items-center gap-2">
								<i class="fas fa-file-excel text-purple-600"></i>
								{{ combined_report.filename }}
							</span>
							<span class="flex items-center gap-2">
								<i class="fas fa-calendar-alt text-purple-600"></i>
								{{ combined_report.modified.strftime('%Y-%m-%d %H:%M') }}
							</span>
							<span class="flex items-center gap-2">
								<i class="fas fa-database text-purple-600"></i>
								{{ (combined_report.size / 1024)|round(1) }} KB
							</span>
						</div>
					</div>
					<a href="/download-combined-reports"
						class="group relative inline-flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all duration-200">
						<i class="fas fa-download"></i>
						<span>Download</span>
						<div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 rounded-lg transition-opacity duration-200"></div>
					</a>
				</div>
			</div>
			{% endif %}

			{% if files %}

			<div class="bg-white rounded-lg overflow-hidden shadow-sm">
				<div class="space-y-6 p-4">
					{% for user, user_files in files_by_user.items() %}
					<div class="border-l-4 border-orange-100 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4">
						<div class="flex items-center gap-3 mb-3">
							<div class="w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center">
								<i class="fas fa-user text-white text-sm"></i>
							</div>
							<div>
								<h3 class="text-lg font-semibold text-gray-900">{{ user }}</h3>
								<p class="text-sm text-gray-600">{{ user_files|length }} report(s) downloaded</p>
							</div>
						</div>

						<div class="grid grid-cols-1 gap-2">
							{% for file_info in user_files %}
							<div
								class="group relative bg-white hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 transition-all duration-200 p-3 rounded-lg border border-gray-200">
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-3 flex-1">
										<div
											class="w-10 h-10 bg-gradient-to-r from-orange-100 to-red-100 rounded-lg flex items-center justify-center group-hover:from-orange-200 group-hover:to-red-200 transition-colors">
											<i class="fas fa-file-excel text-orange-600"></i>
										</div>
										<div class="flex-1 min-w-0">
											<div class="flex items-center gap-2 mb-1">
												<h4 class="text-sm font-semibold text-gray-900 truncate">{{ file_info.report_name }}</h4>
												<div class="flex-shrink-0">
													<span
														class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
														<i class="fas fa-check-circle mr-1"></i>Ready
													</span>
												</div>
											</div>
											<div class="flex items-center gap-4 text-xs text-gray-500">
												<span class="flex items-center gap-1">
													<i class="fas fa-file-alt"></i>XLSX Format
												</span>
												<span class="flex items-center gap-1">
													<i class="fas fa-clock"></i>Recently generated
												</span>
												<span class="flex items-center gap-1">
													<i class="fas fa-user-tag"></i>{{ file_info.user }}
												</span>
											</div>
										</div>
									</div>

									<div class="flex items-center gap-2">
										<a href="/download/{{ file_info.filename }}"
											class="group/btn relative inline-flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-orange-600 to-red-600 text-white font-medium rounded-lg shadow-md hover:from-orange-700 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-300 transition-all duration-200 text-sm">
											<i class="fas fa-download"></i>
											<span>Download</span>
											<div
												class="absolute inset-0 bg-white opacity-0 group-hover/btn:opacity-20 rounded-lg transition-opacity duration-200">
											</div>
										</a>
									</div>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
					{% endfor %}
				</div>
			</div>

			{% else %}
			<div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-12 text-center border border-gray-200">
				<div
					class="w-24 h-24 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full flex items-center justify-center mx-auto mb-6">
					<i class="fas fa-folder-open text-gray-500 text-3xl"></i>
				</div>
				<h3 class="text-xl font-semibold text-gray-900 mb-2">No Reports Yet</h3>
				<p class="text-gray-600 mb-6 max-w-md mx-auto">Your downloaded reports will appear here once you run
					the scraper. Configure your settings above and click "Start Scraping" to begin.</p>
				<div class="flex items-center justify-center gap-2 text-sm text-gray-500">
					<i class="fas fa-lightbulb"></i>
					<span>Tip: Make sure you have users configured before scraping</span>
				</div>
			</div>
			{% endif %}
		</div>
	</div>

	<script>
		// Enhanced toggle functionality with visual feedback
		function toggleAll(checked) {
			const checkboxes = document.querySelectorAll('.tab-checkbox');
			const selectAllIcon = document.getElementById('select-all-icon');
			const selectAllCheckbox = document.getElementById('select-all');
			const selectAllVisual = selectAllIcon.parentElement; // The div containing the visual checkbox

			checkboxes.forEach(checkbox => {
				checkbox.checked = checked;
				updateTabVisual(checkbox);
			});

			// Update select all visual
			if (checked) {
				selectAllIcon.style.opacity = '1';
				selectAllVisual.style.backgroundColor = '#2563eb';
				selectAllVisual.style.borderColor = '#2563eb';
				selectAllCheckbox.checked = true;
			} else {
				selectAllIcon.style.opacity = '0';
				selectAllVisual.style.backgroundColor = 'white';
				selectAllVisual.style.borderColor = '#d1d5db';
				selectAllCheckbox.checked = false;
			}
		}

		// Update tab card visual state
		function updateTabVisual(checkbox) {
			const card = checkbox.closest('.tab-card');
			const icon = card.querySelector('.tab-check-icon');
			const visual = card.querySelector('.tab-checkbox-visual');

			if (checkbox.checked) {
				card.style.borderColor = '#2563eb';
				card.style.backgroundColor = '#f3f4f6';
				visual.style.backgroundColor = '#2563eb';
				visual.style.borderColor = '#2563eb';
				icon.style.opacity = '1';
			} else {
				card.style.borderColor = '#e5e7eb';
				card.style.backgroundColor = 'white';
				visual.style.backgroundColor = 'white';
				visual.style.borderColor = '#d1d5db';
				icon.style.opacity = '0';
			}
		}

		// Check if all individual checkboxes are checked
		function updateSelectAllState() {
			const checkboxes = document.querySelectorAll('.tab-checkbox');
			const allChecked = Array.from(checkboxes).every(cb => cb.checked);
			const selectAllCheckbox = document.getElementById('select-all');
			const selectAllIcon = document.getElementById('select-all-icon');
			const selectAllVisual = selectAllIcon.parentElement;

			selectAllCheckbox.checked = allChecked;

			if (allChecked) {
				selectAllIcon.style.opacity = '1';
				selectAllVisual.style.backgroundColor = '#2563eb';
				selectAllVisual.style.borderColor = '#2563eb';
			} else {
				selectAllIcon.style.opacity = '0';
				selectAllVisual.style.backgroundColor = 'white';
				selectAllVisual.style.borderColor = '#d1d5db';
			}
		}

		// Initialize tab visuals on page load
		document.addEventListener('DOMContentLoaded', function () {
			document.querySelectorAll('.tab-checkbox').forEach(updateTabVisual);
			updateSelectAllState(); // Initialize select-all state

			// Add click listeners to tab cards
			document.querySelectorAll('.tab-card').forEach(card => {
				card.addEventListener('click', function () {
					const checkbox = this.querySelector('.tab-checkbox');
					checkbox.checked = !checkbox.checked;
					updateTabVisual(checkbox);
					updateSelectAllState(); // Update select-all state when individual items change
				});
			});

			// Add products filter change listener
			const productsFilter = document.getElementById('products_filter');
			const productsWarning = document.getElementById('products-filter-warning');
			
			if (productsFilter && productsWarning) {
				productsFilter.addEventListener('change', function() {
					// Show warning for all products since availability varies by user
					if (this.value) {
						productsWarning.classList.remove('hidden');
						// Auto-hide after 5 seconds
						setTimeout(() => {
							productsWarning.classList.add('hidden');
						}, 5000);
					}
				});
			}
		});

		function getUserRows() {
			return Array.from(document.querySelectorAll('.user-row')).map(row => ({
				username: row.querySelector('input[name="username"]').value,
				password: row.querySelector('input[name="password"]').value
			}));
		}

		function addUser() {
			const container = document.getElementById('users-container');
			const emptyState = document.getElementById('empty-users');

			const userRow = document.createElement('div');
			userRow.className = 'group bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 user-row';
			userRow.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <div class="space-y-2">
                        <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-user mr-1"></i>Username
                        </label>
                        <input type="text" name="username" value=""
                            class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 focus:bg-white transition-all duration-200"
                            placeholder="Enter email or username">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-xs font-semibold text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-lock mr-1"></i>Password
                        </label>
                        <input type="password" name="password" value=""
                            class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-900 font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 focus:bg-white transition-all duration-200"
                            placeholder="Enter password">
                    </div>
                    <div class="flex justify-center md:justify-end">
                        <button type="button"
                            class="group/remove relative inline-flex items-center gap-2 px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow-md hover:from-red-600 hover:to-indigo-600 focus:outline-none focus:ring-4 focus:ring-red-300 transform transition-all duration-200 remove-user">
                            <i class="fas fa-trash-alt"></i>
                            <span class="text-sm">Remove</span>
                            <div class="absolute inset-0 bg-white opacity-0 group-hover/remove:opacity-20 rounded-lg transition-opacity duration-200"></div>
                        </button>
                    </div>
                </div>
            `;

			container.appendChild(userRow);
			emptyState.classList.add('hidden');

			// Focus on the username input
			userRow.querySelector('input[name="username"]').focus();
		}

		document.getElementById('add-user').onclick = addUser;
		document.getElementById('add-first-user').onclick = addUser;

		document.getElementById('users-container').onclick = function (e) {
			if (e.target.classList.contains('remove-user') || e.target.closest('.remove-user')) {
				const userRow = e.target.closest('.user-row');
				userRow.remove();

				// Show empty state if no users left
				const remainingUsers = document.querySelectorAll('.user-row');
				if (remainingUsers.length === 0) {
					document.getElementById('empty-users').classList.remove('hidden');
				}
			}
		};
		document.getElementById('users-form').onsubmit = function (e) {
			e.preventDefault();
			const users = getUserRows();
			fetch('/save-users', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ users })
			}).then(r => r.json()).then(data => {
				if (data.status === 'ok') {
					window.location.reload();
				}
			});
		};

		// File name update function
		function updateFileName(input) {
			const label = document.getElementById('file-label');
			if (input.files.length > 0) {
				const fileName = input.files[0].name;
				label.innerHTML = `<i class="fas fa-file-check mr-1"></i>Selected: ${fileName}`;
				label.parentElement.parentElement.classList.add('border-green-300', 'bg-green-50');
				label.parentElement.parentElement.classList.remove('border-blue-300', 'bg-white');
			} else {
				label.textContent = 'Choose JSON file or drag and drop';
				label.parentElement.parentElement.classList.remove('border-green-300', 'bg-green-50');
				label.parentElement.parentElement.classList.add('border-blue-300', 'bg-white');
			}
		}

		// File upload handling
		document.getElementById('upload-form').onsubmit = function (e) {
			e.preventDefault();
			const fileInput = document.getElementById('users-file');
			const messageDiv = document.getElementById('upload-message');

			if (!fileInput.files[0]) {
				showMessage('Please select a file first.', 'error');
				return;
			}

			const formData = new FormData();
			formData.append('users_file', fileInput.files[0]);

			// Show loading state
			const submitBtn = document.getElementById('upload-btn');
			const originalText = submitBtn.innerHTML;
			submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin text-lg"></i><span>Importing...</span>';
			submitBtn.disabled = true;

			fetch('/upload-users', {
				method: 'POST',
				body: formData
			})
				.then(response => response.json())
				.then(data => {
					if (data.status === 'ok') {
						showMessage(data.message, 'success');
						// Reset file input
						fileInput.value = '';
						updateFileName(fileInput);
						// Reload the page to show updated users
						setTimeout(() => window.location.reload(), 1500);
					} else {
						showMessage(data.error || 'Upload failed', 'error');
					}
				})
				.catch(error => {
					showMessage('Error uploading file: ' + error.message, 'error');
				})
				.finally(() => {
					// Restore button state
					submitBtn.innerHTML = originalText;
					submitBtn.disabled = false;
				});
		};

		function showMessage(message, type) {
			const messageDiv = document.getElementById('upload-message');
			messageDiv.innerHTML = type === 'success'
				? `<i class="fas fa-check-circle mr-2"></i>${message}`
				: `<i class="fas fa-exclamation-triangle mr-2"></i>${message}`;

			messageDiv.className = `p-3 rounded-lg text-sm font-medium flex items-center ${type === 'success'
				? 'bg-green-100 text-green-800 border border-green-200'
				: 'bg-red-100 text-red-800 border border-red-200'
				}`;
			messageDiv.classList.remove('hidden');

			// Hide message after 5 seconds
			setTimeout(() => {
				messageDiv.classList.add('hidden');
			}, 5000);
		}

		// Notification system functions
		let notificationPollingInterval = null;
		
		function showNotification(message, type = 'warning', timestamp = null) {
			const notificationsSection = document.getElementById('scraper-notifications');
			const notificationsContent = document.getElementById('notifications-content');
			
			const notification = document.createElement('div');
			notification.className = `flex items-start gap-3 p-4 rounded-lg border ${
				type === 'error' ? 'bg-red-50 border-red-200' :
				type === 'warning' ? 'bg-yellow-50 border-yellow-200' :
				'bg-blue-50 border-blue-200'
			}`;
			
			const timeStr = timestamp ? new Date(timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
			
			notification.innerHTML = `
				<div class="flex-shrink-0">
					<div class="w-6 h-6 ${
						type === 'error' ? 'bg-red-600' :
						type === 'warning' ? 'bg-yellow-600' :
						'bg-blue-600'
					} rounded-full flex items-center justify-center">
						<i class="fas ${
							type === 'error' ? 'fa-times' :
							type === 'warning' ? 'fa-exclamation-triangle' :
							'fa-info'
						} text-white text-xs"></i>
					</div>
				</div>
				<div class="flex-1">
					<p class="text-sm font-medium ${
						type === 'error' ? 'text-red-800' :
						type === 'warning' ? 'text-yellow-800' :
						'text-blue-800'
					}">${message}</p>
					<p class="text-xs ${
						type === 'error' ? 'text-red-600' :
						type === 'warning' ? 'text-yellow-600' :
						'text-blue-600'
					} mt-1">${timeStr}</p>
				</div>
				<button onclick="this.parentElement.remove(); checkNotificationsEmpty();" 
					class="flex-shrink-0 p-1 ${
						type === 'error' ? 'text-red-400 hover:text-red-600' :
						type === 'warning' ? 'text-yellow-400 hover:text-yellow-600' :
						'text-blue-400 hover:text-blue-600'
					} transition-colors">
					<i class="fas fa-times text-xs"></i>
				</button>
			`;
			
			notificationsContent.appendChild(notification);
			notificationsSection.classList.remove('hidden');
		}
		
		function checkNotificationsEmpty() {
			const notificationsSection = document.getElementById('scraper-notifications');
			const notificationsContent = document.getElementById('notifications-content');
			
			if (notificationsContent.children.length === 0) {
				notificationsSection.classList.add('hidden');
			}
		}
		
		function clearAllNotifications() {
			const notificationsContent = document.getElementById('notifications-content');
			notificationsContent.innerHTML = '';
			checkNotificationsEmpty();
			
			// Clear from server
			fetch('/clear-notifications', { method: 'POST' })
				.then(r => r.json())
				.catch(error => console.error('Error clearing notifications:', error));
		}
		
		function loadNotifications() {
			fetch('/scrape-notifications')
				.then(r => r.json())
				.then(data => {
					if (data.notifications && data.notifications.length > 0) {
						// Clear existing notifications first
						const notificationsContent = document.getElementById('notifications-content');
						notificationsContent.innerHTML = '';
						
						data.notifications.forEach(notif => {
							showNotification(notif.message, notif.type, notif.timestamp);
						});
					}
				})
				.catch(error => console.error('Error loading notifications:', error));
		}
		
		function startNotificationPolling() {
			// Poll for notifications every 2 seconds during scraping
			if (notificationPollingInterval) {
				clearInterval(notificationPollingInterval);
			}
			
			notificationPollingInterval = setInterval(() => {
				loadNotifications();
			}, 2000);
		}
		
		function stopNotificationPolling() {
			if (notificationPollingInterval) {
				clearInterval(notificationPollingInterval);
				notificationPollingInterval = null;
			}
		}

		const form = document.getElementById('scrape-form');
		const btn = document.getElementById('scrape-btn');
		const spinner = document.getElementById('spinner');
		const elements = document.querySelector('.scrap-text-elements');

		form.addEventListener('submit', function (e) {
			e.preventDefault();
			btn.disabled = true;
			spinner.classList.add('show');
			elements.classList.add('hidden');
			
			// Don't clear notifications here - let them persist
			// Start polling for notifications
			startNotificationPolling();

			fetch('/scrape', { method: 'POST' })
				.then(response => response.json())
				.then(data => {
					if (data.status === 'started') {
						// Poll for completion and status
						function poll() {
							fetch('/scrape-status').then(r => r.json()).then(status => {
								if (status.in_progress) {
									setTimeout(poll, 1000);
								} else {
									// Scraping completed
									stopNotificationPolling();
									
									// Load final notifications
									loadNotifications();
									
									// Reload page after a short delay to show notifications
									setTimeout(() => {
										// Store that we should load notifications on next page load
										sessionStorage.setItem('showNotifications', 'true');
										window.location.reload();
									}, 1000);
								}
							});
						}
						poll();
					}
				})
				.catch(error => {
					console.error('Error:', error);
					stopNotificationPolling();
					showNotification('Failed to start scraper: ' + error.message, 'error');
					btn.disabled = false;
					spinner.classList.remove('show');
					elements.classList.remove('hidden');
				});
		});
		
		// Load notifications on page load if needed
		if (sessionStorage.getItem('showNotifications') === 'true') {
			sessionStorage.removeItem('showNotifications');
			loadNotifications();
		}
	</script>
</body>

</html>
